<app-filter (filterChange)="applyFilter($event)"></app-filter>

<p-carousel
  [value]="filteredAssignments"
  [numVisible]="responsiveOptions ? responsiveOptions[0].numVisible : 3"
  [numScroll]="responsiveOptions ? responsiveOptions[0].numScroll : 1"
  [circular]="filteredAssignments.length > (responsiveOptions && responsiveOptions[0].numVisible ? responsiveOptions[0].numVisible : 3)"
  [responsiveOptions]="responsiveOptions"
  [showIndicators]="filteredAssignments.length > (responsiveOptions && responsiveOptions[0].numVisible ? responsiveOptions[0].numVisible : 3)"
  (onPage)="pageChange($event)"
  styleClass="custom-carousel">
  <ng-template let-assignment pTemplate="item">
    <div class="carousel-item-container">
      <div class="assignment-card">
        <div class="card-header mb-3">
          <h4 class="mb-1">{{ assignment.nom }}</h4>
          <small class="text-muted">Matière: {{ assignment.matiere }}</small>
        </div>

        <div class="card-content-wrapper">
          <p-tabView styleClass="tabview-custom">
            <p-tabPanel header="Détails">
              <div class="details-grid py-2">
                <div><strong>Date de Rendu:</strong> {{ assignment.dateDeRendu | date:'dd/MM/yyyy HH:mm' }}</div>
                <div><strong>Note:</strong> {{ assignment.note !== null && assignment.note !== undefined ? (assignment.note | number:'1.0-2') + '/20' : 'Non noté' }}</div>
                <div><strong>Statut:</strong> <p-tag [value]="assignment.statut" [severity]="getStatutSeverity(assignment.statut)"></p-tag></div>
                <div><strong>Professeur:</strong> {{ assignment.professeur?.nomProf || 'N/A' }}</div>
                <div><strong>Élève:</strong> {{ assignment.eleve?.nomEleve || 'N/A' }}</div>
                <div class="tags-container">
                  <strong>Tags:</strong>
                  <ng-container *ngIf="assignment.tags && assignment.tags.length > 0; else noTags">
                    <p-tag *ngFor="let tag of assignment.tags" [value]="tag" styleClass="mr-1 mt-1"></p-tag>
                  </ng-container>
                  <ng-template #noTags><span>Aucun tag</span></ng-template>
                </div>
                <div>
                  <strong>Visibilité:</strong>
                  <i [class]="assignment.visible ? 'pi pi-eye' : 'pi pi-eye-slash'"
                     [pTooltip]="assignment.visible ? 'Visible' : 'Caché'"
                     [style.color]="assignment.visible ? 'green' : 'red'"></i>
                </div>
                <div>
                  <strong>Verrouillage:</strong>
                  <i [class]="assignment.locked ? 'pi pi-lock' : 'pi pi-lock-open'"
                     [pTooltip]="assignment.locked ? 'Verrouillé' : 'Déverrouillé'"
                     [style.color]="assignment.locked ? 'orange' : 'inherit'"></i>
                </div>
              </div>
            </p-tabPanel>
            <p-tabPanel header="Exercice" [disabled]="!assignment.exercice">
              <div class="py-2 exercice-content" [innerHTML]="assignment.exercice | safeHtml">
              </div>
              <p *ngIf="!assignment.exercice && !assignment.exercice?.length">Aucune description d'exercice.</p>
            </p-tabPanel>
          </p-tabView>
        </div>
        <div class="card-footer mt-auto">
          <button *ngIf="authService.isAdmin()" pButton
                  type="button"
                  icon="pi pi-pencil"
                  (click)="openEditModal(assignment)"
                  class="p-button-sm p-button-info me-2"
                  pTooltip="Éditer"
                  [disabled]="isEditDisabled(assignment)" [pTooltip]="isEditDisabled(assignment) ? 'Verrouillé (seul le prof. assigné peut éditer)' : 'Éditer'"
                  tooltipPosition="top">
          </button>
          <button *ngIf="authService.isAdmin()"
                  pButton
                  type="button"
                  icon="pi pi-trash"
                  [disabled]="isEditDisabled(assignment)" [pTooltip]="isEditDisabled(assignment) ? 'Verrouillé (seul le prof. assigné peut supprimer)' : 'Supprimer'"
                  (click)="confirmDelete($event, assignment._id)" class="p-button-sm p-button-danger"
                  pTooltip="Supprimer">
          </button>
        </div>
      </div>
    </div>
  </ng-template>

</p-carousel>
<app-edit-assignment-modal #editModal (assignmentUpdated)="onAssignmentUpdated($event)"></app-edit-assignment-modal>

<div class="pagination-info text-center mt-3" *ngIf="filteredAssignments.length > 0">
  Page {{ page + 1 }} / {{ totalPages }}
</div>

<p-confirmPopup></p-confirmPopup>



