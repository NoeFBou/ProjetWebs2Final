<div class="organisation-container p-4">
  <p-card header="Mon Organisation" subheader="Vue hiÃ©rarchique de mes relations et assignments">
    <div *ngIf="isLoading" class="text-center py-5">
      <i class="pi pi-spin pi-spinner" style="font-size: 3rem;"></i>
      <p class="mt-2">Chargement de l'organigramme...</p>
    </div>

    <div *ngIf="!isLoading && chartData && chartData.length > 0">
      <p-organizationChart [value]="chartData" [collapsible]="true" selectionMode="single">
        <ng-template let-node pTemplate="person">
          <div class="node-content p-2 text-center" [ngClass]="node.styleClass">
            <ng-container *ngIf="node.type === 'user' && node.data">
              <p-avatar
                [image]="node.data.image"
                [label]="!node.data.image ? getAvatarLabel(node.data.name) : ''"
                size="large"
                shape="circle"
                styleClass="node-avatar mb-2">
              </p-avatar>
              <div class="font-bold node-name">{{ node.label }}</div>
              <div class="text-sm node-title">{{ node.data.title }}</div>
              <div *ngIf="node.data.image" class="text-xs mt-1" style="word-break: break-all; color: #757575;">
                <small>URL: {{ node.data.image }}</small>
              </div>
              <div *ngIf="!node.data.image" class="text-xs mt-1" style="color: #d9534f;">
                <small>Pas d'image</small>
              </div>
            </ng-container>
          </div>
        </ng-template>
      </p-organizationChart>
    </div>
  </p-card>
</div>
